{ 
2    "$schema":"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#", 
3    "contentVersion":"1.0.0.0", 
4    "parameters":{ 
5       "location":{ 
6          "type":"string", 
7          "metadata":{ 
8             "description":"The region to deploy the resources into" 
9          } 
10       }, 
11       "sharepointFarmName":{ 
12          "type":"string", 
13          "metadata":{ 
14             "description":"The name of the Sharepoint farm" 
15          }, 
16          "defaultValue":"spfarm" 
17       }, 
18       "adminUsername":{ 
19          "type":"string", 
20          "metadata":{ 
21             "description":"The name of the Administrator of the new VMs and Domain" 
22          } 
23       }, 
24       "adminPassword":{ 
25          "type":"securestring", 
26          "metadata":{ 
27             "description":"The password for the Administrator account of the new VMs and Domain" 
28          } 
29       }, 
30       "adVMSize":{ 
31          "type":"string", 
32          "allowedValues":[ 
33             "Standard_D1", 
34             "Standard_DS1", 
35             "Standard_D2", 
36             "Standard_DS2", 
37             "Standard_D3", 
38             "Standard_DS3", 
39             "Standard_D4", 
40             "Standard_DS4", 
41             "Standard_D11", 
42             "Standard_DS11", 
43             "Standard_D12", 
44             "Standard_DS12", 
45             "Standard_D13", 
46             "Standard_DS13", 
47             "Standard_D14", 
48             "Standard_DS14" 
49          ], 
50          "metadata":{ 
51             "description":"The size of the AD VMs Created" 
52          }, 
53          "defaultValue":"Standard_DS1" 
54       }, 
55       "sqlVMSize":{ 
56          "type":"string", 
57          "allowedValues":[ 
58             "Standard_D1", 
59             "Standard_DS1", 
60             "Standard_D2", 
61             "Standard_DS2", 
62             "Standard_D3", 
63             "Standard_DS3", 
64             "Standard_D4", 
65             "Standard_DS4", 
66             "Standard_D11", 
67             "Standard_DS11", 
68             "Standard_D12", 
69             "Standard_DS12", 
70             "Standard_D13", 
71             "Standard_DS13", 
72             "Standard_D14", 
73             "Standard_DS14" 
74          ], 
75          "metadata":{ 
76             "description":"The size of the SQL VMs Created" 
77          }, 
78          "defaultValue":"Standard_DS3" 
79       }, 
80       "witnessVMSize":{ 
81          "type":"string", 
82          "allowedValues":[ 
83             "Standard_D1", 
84             "Standard_DS1", 
85             "Standard_D2", 
86             "Standard_DS2", 
87             "Standard_D3", 
88             "Standard_DS3", 
89             "Standard_D4", 
90             "Standard_DS4", 
91             "Standard_D11", 
92             "Standard_DS11", 
93             "Standard_D12", 
94             "Standard_DS12", 
95             "Standard_D13", 
96             "Standard_DS13", 
97             "Standard_D14", 
98             "Standard_DS14" 
99          ], 
100          "metadata":{ 
101             "description":"The size of the Witness VM Created" 
102          }, 
103          "defaultValue":"Standard_DS1" 
104       }, 
105       "spVMSize":{ 
106          "type":"string", 
107          "allowedValues":[ 
108             "Standard_D1", 
109             "Standard_DS1", 
110             "Standard_D2", 
111             "Standard_DS2", 
112             "Standard_D3", 
113             "Standard_DS3", 
114             "Standard_D4", 
115             "Standard_DS4", 
116             "Standard_D11", 
117             "Standard_DS11", 
118             "Standard_D12", 
119             "Standard_DS12", 
120             "Standard_D13", 
121             "Standard_DS13", 
122             "Standard_D14", 
123             "Standard_DS14" 
124          ], 
125          "metadata":{ 
126             "description":"The size of the SP VMs Created" 
127          }, 
128          "defaultValue":"Standard_DS2" 
129       }, 
130       "domainName":{ 
131          "type":"string", 
132          "metadata":{ 
133             "description":"The FQDN of the AD Domain created " 
134          }, 
135          "defaultValue":"sphafarm.local" 
136       }, 
137       "sqlServerServiceAccountUserName":{ 
138          "type":"string", 
139          "metadata":{ 
140             "description":"The SQL Server Service account name" 
141          }, 
142          "defaultValue":"sqlservice" 
143       }, 
144       "sqlServerServiceAccountPassword":{ 
145          "type":"securestring", 
146          "metadata":{ 
147             "description":"The SQL Server Service account password" 
148          } 
149       }, 
150       "sharePointSetupUserAccountUserName":{ 
151          "type":"string", 
152          "metadata":{ 
153             "description":"The Sharepoint Setup account name" 
154          }, 
155          "defaultValue":"sp_setup" 
156       }, 
157       "sharePointSetupUserAccountPassword":{ 
158          "type":"securestring", 
159          "metadata":{ 
160             "description":"The Sharepoint Setup account password" 
161          } 
162       }, 
163       "sharePointFarmAccountUserName":{ 
164          "type":"string", 
165          "metadata":{ 
166             "description":"The Sharepoint Farm account name" 
167          }, 
168          "defaultValue":"sp_farm" 
169       }, 
170       "sharePointFarmAccountPassword":{ 
171          "type":"securestring", 
172          "metadata":{ 
173             "description":"The Sharepoint Farm account password" 
174          } 
175       }, 
176       "sharePointFarmPassphrasePassword":{ 
177          "type":"securestring", 
178          "metadata":{ 
179             "description":"The Sharepoint Farm Passphrase" 
180          } 
181       }, 
182       "spSiteTemplateName":{ 
183          "type":"string", 
184          "metadata":{ 
185             "description":"The Sharepoint Content Site Template Name" 
186          }, 
187          "defaultValue":"STS#0" 
188       }, 
189       "storageAccountNamePrefix":{ 
190          "type":"string", 
191          "metadata":{ 
192             "description":"The prefix of the new storage account created to store the VMs disks, different storage accounts will be created for AD,SQL and Sharepoint VMs" 
193          } 
194       }, 
195       "storageAccountType":{ 
196          "type":"string", 
197          "metadata":{ 
198             "description":"The type of the Storage Account created" 
199          }, 
200          "defaultValue":"Premium_LRS" 
201       }, 
202       "virtualNetworkAddressRange":{ 
203          "type":"string", 
204          "metadata":{ 
205             "description":"The address range of the new VNET in CIDR format" 
206          }, 
207          "defaultValue":"10.0.0.0/16" 
208       }, 
209       "staticSubnet":{ 
210          "type":"string", 
211          "metadata":{ 
212             "description":"The address range of the subnet static IPs are allocated from in the new VNET" 
213          }, 
214          "defaultValue":"10.0.0.0/24" 
215       }, 
216       "sqlSubnet":{ 
217          "type":"string", 
218          "metadata":{ 
219             "description":"The address range of the SQL subnet created in the new VNET" 
220          }, 
221          "defaultValue":"10.0.1.0/24" 
222       }, 
223       "spWebSubnet":{ 
224          "type":"string", 
225          "metadata":{ 
226             "description":"The address range of the SP Web subnet created in the new VNET" 
227          }, 
228          "defaultValue":"10.0.2.0/24" 
229       }, 
230       "spAppSubnet":{ 
231          "type":"string", 
232          "metadata":{ 
233             "description":"The address range of the SP App subnet created in the new VNET" 
234          }, 
235          "defaultValue":"10.0.3.0/24" 
236       }, 
237       "adPDCNICIPAddress":{ 
238          "type":"string", 
239          "metadata":{ 
240             "description":"The IP address of the new AD VM" 
241          }, 
242          "defaultValue":"10.0.0.4" 
243       }, 
244       "adBDCNICIPAddress":{ 
245          "type":"string", 
246          "metadata":{ 
247             "description":"The IP address of the new AD VM" 
248          }, 
249          "defaultValue":"10.0.0.5" 
250       }, 
251       "sqlLBIPAddress":{ 
252          "type":"string", 
253          "metadata":{ 
254             "description":"The IP address of the new SQL ILB" 
255          }, 
256          "defaultValue":"10.0.0.6" 
257       }, 
258       "spWebIPRGName":{ 
259          "type":"string", 
260          "defaultValue":"", 
261          "metadata":{ 
262             "description":"Resource Group containing existing SP Web IP address" 
263          } 
264       }, 
265       "spWebIPAddressName":{ 
266          "type":"string", 
267          "metadata":{ 
268             "description":"The existing IP address name for SP Web" 
269          } 
270       }, 
271       "spWebIPNewOrExisting":{ 
272          "type":"string", 
273          "defaultValue":"new", 
274          "allowedValues":[ 
275             "new", 
276             "existing" 
277          ], 
278          "metadata":{ 
279             "description":"Indicates whether the Sharepoint farm's IP is new or existing" 
280          } 
281       }, 
282       "dnsPrefix":{ 
283          "type":"string", 
284          "metadata":{ 
285             "description":"The DNS Prefix for the Public IP Address for the Sharepoint Web Application" 
286          } 
287       }, 
288       "spCADNSPrefix":{ 
289          "type":"string", 
290          "metadata":{ 
291             "description":"The DNS Prefix for the Public IP Address for the Central Admin site" 
292          } 
293       }, 
294       "spCAIPAddressName":{ 
295          "type":"string", 
296          "metadata":{ 
297             "description":"The existing IP address name for SP Central Admin site" 
298          } 
299       }, 
300       "spCAIPNewOrExisting":{ 
301          "type":"string", 
302          "defaultValue":"new", 
303          "allowedValues":[ 
304             "new", 
305             "existing" 
306          ], 
307          "metadata":{ 
308             "description":"Indicates whether the Sharepoint farm's IP is new or existing" 
309          } 
310       }, 
311       "spCARGName":{ 
312          "type":"string", 
313          "defaultValue":"", 
314          "metadata":{ 
315             "description":"Resource Group containing existing IP address for SP Central Admin site" 
316          } 
317       }, 
318       "virtualNetworkName" : { 
319         "type" : "string", 
320         "defaultValue" : "spfarmhaVNET", 
321         "metadata":{ 
322            "description":"Name of virtual network to be created" 
323         } 
324       }, 
325       "baseUrl":{ 
326          "type":"string", 
327          "metadata":{ 
328             "description":"Base URL for Marketplace", 
329             "artifactsBaseUrl":"" 
330          }, 
331          "defaultValue":"https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/sharepoint-server-farm-ha" 
332       } 
333    }, 
334    "variables":{ 
335       "configDatabaseName":"SP_Config", 
336       "administrationContentDatabaseName":"SP_AdminContent", 
337       "contentDatabaseName":"spfarm_Content", 
338       "lbSettings":{ 
339          "rdpLBFE":"rdpLBFE", 
340          "sqlLBFE":"sqlLBFE", 
341          "spWebLBFE":"spWebLBFE", 
342          "spCALBFE":"spCALBFE", 
343          "adLBBE":"adLBBE", 
344          "sqlLBBE":"sqlLBBE", 
345          "spWebLBBE":"spWebLBBE", 
346          "spCALBBE":"spCALBBE", 
347          "spWebLB":"spWeb", 
348          "spCALB":"spCALB", 
349          "sqlLBName":"sqlLoadBalancer", 
350          "rdpLBName":"rdpLoadBalancer", 
351          "spWebLBName":"spWebLoadBalancer", 
352          "spCALBName":"spCALoadBalancer" 
353       }, 
354       "subnetNames":{ 
355          "staticSubnetName":"staticSubnet", 
356          "sqlSubnetName":"sqlSubnet", 
357          "spWebSubnetName":"spWebSubnet", 
358          "spAppSubnetName":"spAppSubnet" 
359       }, 
360       "RDPNAT":"RDP", 
361       "spCANAT":"spCANAT", 
362       "SQLAOProbe":"SQLAlwaysOnEndPointProbe", 
363       "spWebProbe":"spWebProbe", 
364       "spWebProbePort":8088, 
365       "rdpIPAddressName":"rdpIP", 
366       "vmSettings":{ 
367          "availabilitySets":{ 
368             "sqlAvailabilitySetName":"sqlAvailabilitySet", 
369             "adAvailabilitySetName":"adAvailabilitySet", 
370             "spWebAvailabilitySetName":"spWebAvailabilitySet", 
371             "spAppAvailabilitySetName":"spAppAvailabilitySet" 
372          }, 
373          "noOfSqlVMs":2, 
374          "noOfspRoleVMs":2, 
375          "vmContainerName":"vhds", 
376          "adPDCVMName":"ad-pdc", 
377          "adBDCVMName":"ad-bdc", 
378          "sqlVMName":"sql-", 
379          "sqlwVMName":"sql-w", 
380          "spwebVMName":"sps-web-", 
381          "spappVMName":"sps-app-", 
382          "windowsImagePublisher":"MicrosoftWindowsServer", 
383          "windowsImageOffer":"WindowsServer", 
384          "windowsImageSKU":"2012-R2-Datacenter", 
385          "sqlImagePublisher":"MicrosoftSQLServer", 
386          "sqlImageOffer":"SQL2014-WS2012R2", 
387          "sqlImageSKU":"Enterprise", 
388          "spImagePublisher":"MicrosoftSharePoint", 
389          "spImageOffer":"MicrosoftSharePointServer", 
390          "spImageSKU":"2013", 
391          "rdpPort":3389, 
392          "spCentralAdminPort":80, 
393          "windowsDiskSize":128, 
394          "sqlDiskSize":1000, 
395          "spDiskSize":128 
396       }, 
397       "sqlAOEPName":"[concat(parameters('dnsPrefix'),'-hadr')]", 
398       "sqlAOAGName":"[concat(parameters('dnsPrefix'),'-ag')]", 
399       "sqlAOListenerName":"[concat(parameters('dnsPrefix'),'ag-listener')]", 
400       "sharePath":"[concat(parameters('dnsPrefix'),'-fsw')]", 
401       "clusterName":"[concat(parameters('dnsPrefix'),'-fc')]", 
402       "adPDCNicName":"[concat(variables('vmSettings').adPDCVMName,'-nic')]", 
403       "adBDCNicName":"[concat(variables('vmSettings').adBDCVMName,'-nic')]", 
404       "sqlwNicName":"[concat(variables('vmSettings').sqlwVMName,'-nic')]", 
405       "VnetID":"[resourceId('Microsoft.Network/virtualNetworks', parameters('virtualNetworkName'))]", 
406       "staticSubnetRef":"[concat(variables('VnetID'),'/subnets/',variables('subnetNames').staticSubnetName)]", 
407       "sqlSubnetRef":"[concat(variables('VnetID'),'/subnets/',variables('subnetNames').sqlSubnetName)]", 
408       "spWebSubnetRef":"[concat(variables('VnetID'),'/subnets/',variables('subnetNames').spWebSubnetName)]", 
409       "spAppSubnetRef":"[concat(variables('VnetID'),'/subnets/',variables('subnetNames').spAppSubnetName)]", 
410       "ids":{ 
411          "adNicId":"[resourceId('Microsoft.Network/networkInterfaces',variables('adPDCNicName'))]", 
412          "rdplbID":"[resourceId('Microsoft.Network/loadBalancers',variables('lbSettings').rdpLBName)]", 
413          "spWeblbID":"[resourceId('Microsoft.Network/loadBalancers',variables('lbSettings').spWebLBName)]", 
414          "sqllbID":"[resourceId('Microsoft.Network/loadBalancers',variables('lbSettings').sqlLBName)]", 
415          "spCAlbID":"[resourceId('Microsoft.Network/loadBalancers',variables('lbSettings').spCALBName)]" 
416       }, 
417       "derivedIds":{ 
418          "adIPConfigID":"[concat(variables('ids').adNicId,'/ipConfigurations/ipconfig1')]", 
419          "rdplbFEConfigID":"[concat(variables('ids').rdplbID,'/frontendIPConfigurations/',variables('lbSettings').rdpLBFE)]", 
420          "spWebLBFEConfigID":"[concat(variables('ids').spWeblbID,'/frontendIPConfigurations/',variables('lbSettings').spWebLBFE)]", 
421          "adRDPNATRuleID":"[concat(variables('ids').rdplbID,'/inboundNatRules/',variables('RDPNAT'))]", 
422          "adBEAddressPoolID":"[concat(variables('ids').rdplbID,'/backendAddressPools/',variables('lbSettings').adLBBE)]", 
423          "spWebProbeID":"[concat(variables('ids').spWeblbID,'/probes/',variables('spWebProbe'))]", 
424          "spWebBEAddressPoolID":"[concat(variables('ids').spWeblbID,'/backendAddressPools/',variables('lbSettings').spWebLBBE)]", 
425          "sqlBEAddressPoolID":"[concat(variables('ids').sqllbID,'/backendAddressPools/',variables('lbSettings').sqlLBBE)]", 
426          "sqllbFEConfigID":"[concat(variables('ids').sqllbID,'/frontendIPConfigurations/',variables('lbSettings').sqlLBFE)]", 
427          "sqllbProbeID":"[concat(variables('ids').sqllbID,'/probes/',variables('SQLAOProbe'))]", 
428          "spCABEAddressPoolID":"[concat(variables('ids').spCAlbID,'/backendAddressPools/',variables('lbSettings').spCALBBE)]", 
429          "spCAlbFEConfigID":"[concat(variables('ids').spCAlbID,'/frontendIPConfigurations/',variables('lbSettings').spCALBFE)]", 
430          "spCANATRuleID":"[concat(variables('ids').spCAlbID,'/inboundNatRules/',variables('spCANAT'))]" 
431       }, 
432       "subnets":[ 
433          { 
434             "name":"[variables('subnetNames').staticSubnetName]", 
435             "properties":{ 
436                "addressPrefix":"[parameters('staticSubnet')]" 
437             } 
438          }, 
439          { 
440             "name":"[variables('subnetNames').sqlSubnetName]", 
441             "properties":{ 
442                "addressPrefix":"[parameters('sqlSubnet')]" 
443             } 
444          }, 
445          { 
446             "name":"[variables('subnetNames').spWebSubnetName]", 
447             "properties":{ 
448                "addressPrefix":"[parameters('spWebSubnet')]" 
449             } 
450          }, 
451          { 
452             "name":"[variables('subnetNames').spAppSubnetName]", 
453             "properties":{ 
454                "addressPrefix":"[parameters('spAppSubnet')]" 
455             } 
456          } 
457       ], 
458       "configuration":{ 
459          "vnetwithDNSTemplateURL":"[concat(parameters('baseUrl'),'/vnet-with-dns-server.json')]", 
460          "nicTemplateURL":"[concat(parameters('baseUrl'),'/nic.json')]", 
461          "adPDCModulesURL":"[concat(variables('assetLocation'),'/CreateADPDC.ps1.zip')]", 
462          "adPDCConfigurationFunction":"CreateADPDC.ps1\\CreateADPDC", 
463          "adBDCModulesURL":"[concat(variables('assetLocation'),'/CreateADBDC.ps1.zip')]", 
464          "adBDCConfigurationFunction":"CreateADBDC.ps1\\CreateADBDC", 
465          "fswModulesURL":"[concat(variables('assetLocation'),'/CreateFileShareWitness.ps1.zip')]", 
466          "fswConfigurationFunction":"CreateFileShareWitness.ps1\\CreateFileShareWitness", 
467          "sqlAOPrepareModulesURL":"[concat(variables('assetLocation'),'/PrepareAlwaysOnSqlServer.ps1.zip')]", 
468          "sqlAOPrepareConfigurationFunction":"PrepareAlwaysOnSqlServer.ps1\\PrepareAlwaysOnSqlServer", 
469          "createClusterModulesURL":"[concat(variables('assetLocation'),'/CreateFailoverCluster.ps1.zip')]", 
470          "createClusterConfigurationFunction":"CreateFailoverCluster.ps1\\CreateFailoverCluster", 
471          "spModulesURL":"[concat(variables('assetLocation'),'/ConfigureSharePointServerHA.ps1.zip')]", 
472          "spConfigurationFunction":"ConfigureSharePointServerHA.ps1\\ConfigureSharePointServerHA", 
473          "spWebIPAdressSetupURL":"[concat(parameters('baseUrl'),'/publicip-',parameters('spWebIPNewOrExisting'),'.json')]", 
474          "spCAIPAdressSetupURL":"[concat(parameters('baseUrl'),'/publicip-',parameters('spCAIPNewOrExisting'),'.json')]", 
475          "rdpIPAdressSetupURL":"[concat(parameters('baseUrl'),'/publicip-rdp.json')]", 
476          "availabilitySetSetupURL":"[concat(parameters('baseUrl'),'/availabilitySets.json')]", 
477          "provisioningPrimaryDCURL":"[concat(parameters('baseUrl'),'/provisioningPrimaryDomainController.json')]", 
478          "provisioningBackupDCURL":"[concat(parameters('baseUrl'),'/provisioningBackupDomainController.json')]", 
479          "provisioningSQLAlwaysOnClusterUrl":"[concat(parameters('baseUrl'),'/provisioningSQLAlwaysOnCluster.json')]", 
480          "creatingSharepointVMsURL":"[concat(parameters('baseUrl'),'/creatingSharepointVMs.json')]", 
481          "provisioningSharepointUrl":"[concat(parameters('baseUrl'),'/provisioningSharePoint.json')]", 
482          "creatingStorageAccounts":"[concat(parameters('baseUrl'),'/creatingStorageAccounts.json')]", 
483          "creatingSQLVMsURL":"[concat(parameters('baseUrl'),'/creatingSQLVMs.json')]", 
484          "vnetSetupURL":"[concat(parameters('baseUrl'),'/vnet-new.json')]", 
485          "setupLBsUrl":"[concat(parameters('baseUrl'),'/setupLBs.json')]", 
486          "creatingNicsUrl":"[concat(parameters('baseUrl'),'/creatingNICS.json')]" 
487       }, 
488       "assetLocation":"https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/sharepoint-server-farm-ha/dsc" 
489    }, 
490    "resources":[ 
491       { 
492          "name":"CreatingStorageAccounts", 
493          "type":"Microsoft.Resources/deployments", 
494          "apiVersion":"2015-01-01", 
495          "properties":{ 
496             "mode":"Incremental", 
497             "templateLink":{ 
498                "uri":"[variables('configuration').creatingStorageAccounts]", 
499                "contentVersion":"1.0.0.0" 
500             }, 
501             "parameters":{ 
502                "location":{ 
503                   "value":"[parameters('location')]" 
504                }, 
505                "storageAccountNamePrefix":{ 
506                   "value":"[parameters('storageAccountNamePrefix')]" 
507                }, 
508                "storageAccountType":{ 
509                   "value":"[parameters('storageAccountType')]" 
510                } 
511             } 
512          } 
513       }, 
514       { 
515          "name":"SettingUpRdp", 
516          "type":"Microsoft.Resources/deployments", 
517          "apiVersion":"2015-01-01", 
518          "properties":{ 
519             "mode":"Incremental", 
520             "templateLink":{ 
521                "uri":"[variables('configuration').rdpIPAdressSetupURL]", 
522                "contentVersion":"1.0.0.0" 
523             }, 
524             "parameters":{ 
525                "location":{ 
526                   "value":"[parameters('location')]" 
527                }, 
528                "rdpIPAddressName":{ 
529                   "value":"[variables('rdpIPAddressName')]" 
530                }, 
531                "rdpLBName":{ 
532                   "value":"[variables('lbSettings').rdpLBName]" 
533                }, 
534                "rdpLBFE":{ 
535                   "value":"[variables('lbSettings').rdpLBFE]" 
536                }, 
537                "adLBBE":{ 
538                   "value":"[variables('lbSettings').adLBBE]" 
539                }, 
540                "RDPNAT":{ 
541                   "value":"[variables('RDPNAT')]" 
542                }, 
543                "rdplbFEConfigID":{ 
544                   "value":"[variables('derivedIds').rdplbFEConfigID]" 
545                } 
546             } 
547          } 
548       }, 
549       { 
550          "name":"SettingUpSharepointWebPublicIP", 
551          "type":"Microsoft.Resources/deployments", 
552          "apiVersion":"2015-01-01", 
553          "properties":{ 
554             "mode":"Incremental", 
555             "templateLink":{ 
556                "uri":"[variables('configuration').spWebIPAdressSetupURL]", 
557                "contentVersion":"1.0.0.0" 
558             }, 
559             "parameters":{ 
560                "location":{ 
561                   "value":"[parameters('location')]" 
562                }, 
563                "publicIPAddressName":{ 
564                   "value":"[parameters('spWebIPAddressName')]" 
565                }, 
566                "publicIPAddressType":{ 
567                   "value":"dynamic" 
568                }, 
569                "dnsPrefix":{ 
570                   "value":"[parameters('dnsPrefix')]" 
571                }, 
572                "publicIpRGName":{ 
573                   "value":"[parameters('spWebIPRGName')]" 
574                } 
575             } 
576          } 
577       }, 
578       { 
579          "name":"SettingUpSharepointCentralAdminPublicIP", 
580          "type":"Microsoft.Resources/deployments", 
581          "apiVersion":"2015-01-01", 
582          "properties":{ 
583             "mode":"Incremental", 
584             "templateLink":{ 
585                "uri":"[variables('configuration').spCAIPAdressSetupURL]", 
586                "contentVersion":"1.0.0.0" 
587             }, 
588             "parameters":{ 
589                "location":{ 
590                   "value":"[parameters('location')]" 
591                }, 
592                "publicIPAddressName":{ 
593                   "value":"[parameters('spCAIPAddressName')]" 
594                }, 
595                "publicIPAddressType":{ 
596                   "value":"dynamic" 
597                }, 
598                "dnsPrefix":{ 
599                   "value":"[parameters('spCADNSPrefix')]" 
600                }, 
601                "publicIpRGName":{ 
602                   "value":"[parameters('spCARGName')]" 
603                } 
604             } 
605          } 
606       }, 
607       { 
608          "name":"CreatingAvailabilitySets", 
609          "type":"Microsoft.Resources/deployments", 
610          "apiVersion":"2015-01-01", 
611          "properties":{ 
612             "mode":"Incremental", 
613             "templateLink":{ 
614                "uri":"[variables('configuration').availabilitySetSetupURL]", 
615                "contentVersion":"1.0.0.0" 
616             }, 
617             "parameters":{ 
618                "location":{ 
619                   "value":"[parameters('location')]" 
620                }, 
621                "adAvailabilitySetName":{ 
622                   "value":"[variables('vmSettings').availabilitySets.adAvailabilitySetName]" 
623                }, 
624                "sqlAvailabilitySetName":{ 
625                   "value":"[variables('vmSettings').availabilitySets.sqlAvailabilitySetName]" 
626                }, 
627                "spWebAvailabilitySetName":{ 
628                   "value":"[variables('vmSettings').availabilitySets.spWebAvailabilitySetName]" 
629                }, 
630                "spAppAvailabilitySetName":{ 
631                   "value":"[variables('vmSettings').availabilitySets.spAppAvailabilitySetName]" 
632                } 
633             } 
634          } 
635       }, 
636       { 
637          "name":"CreatingVirtualNetwork", 
638          "type":"Microsoft.Resources/deployments", 
639          "apiVersion":"2015-01-01", 
640          "properties":{ 
641             "mode":"Incremental", 
642             "templateLink":{ 
643                "uri":"[variables('configuration').vnetSetupURL]", 
644                "contentVersion":"1.0.0.0" 
645             }, 
646             "parameters":{ 
647                "location":{ 
648                   "value":"[parameters('location')]" 
649                }, 
650                "virtualNetworkName":{ 
651                   "value":"[parameters('virtualNetworkName')]" 
652                }, 
653                "virtualNetworkAddressRange":{ 
654                   "value":"[parameters('virtualNetworkAddressRange')]" 
655                }, 
656                "subnets":{ 
657                   "value":"[variables('subnets')]" 
658                } 
659             } 
660          } 
661       }, 
662       { 
663          "name":"SettingUpLoadBalancers", 
664          "type":"Microsoft.Resources/deployments", 
665          "apiVersion":"2015-01-01", 
666          "dependsOn":[ 
667             "Microsoft.Resources/deployments/SettingUpSharepointCentralAdminPublicIP", 
668             "Microsoft.Resources/deployments/SettingUpSharepointWebPublicIP", 
669             "Microsoft.Resources/deployments/SettingUpRdp", 
670             "Microsoft.Resources/deployments/CreatingVirtualNetwork" 
671          ], 
672          "properties":{ 
673             "mode":"Incremental", 
674             "templateLink":{ 
675                "uri":"[variables('configuration').setupLBsUrl]", 
676                "contentVersion":"1.0.0.0" 
677             }, 
678             "parameters":{ 
679                "location":{ 
680                   "value":"[parameters('location')]" 
681                }, 
682                "spCALBName":{ 
683                   "value":"[variables('lbSettings').spCALBName]" 
684                }, 
685                "spCALBFE":{ 
686                   "value":"[variables('lbSettings').spCALBFE]" 
687                }, 
688                "spCAResourceId":{ 
689                   "value":"[reference('SettingUpSharepointCentralAdminPublicIP').outputs.resourceId.value]" 
690                }, 
691                "spCALBBE":{ 
692                   "value":"[variables('lbSettings').spCALBBE]" 
693                }, 
694                "spCANAT":{ 
695                   "value":"[variables('spCANAT')]" 
696                }, 
697                "spCAlbFEConfigID":{ 
698                   "value":"[variables('derivedIds').spCAlbFEConfigID]" 
699                }, 
700                "spWebLBName":{ 
701                   "value":"[variables('lbSettings').spWebLBName]" 
702                }, 
703                "spWebLBFE":{ 
704                   "value":"[variables('lbSettings').spWebLBFE]" 
705                }, 
706                "spWebResourceId":{ 
707                   "value":"[reference('SettingUpSharepointWebPublicIP').outputs.resourceId.value]" 
708                }, 
709                "spWebLBBE":{ 
710                   "value":"[variables('lbSettings').spWebLBBE]" 
711                }, 
712                "spWebLB":{ 
713                   "value":"[variables('lbSettings').spWebLB]" 
714                }, 
715                "spWebLBFEConfigID":{ 
716                   "value":"[variables('derivedIds').spWebLBFEConfigID]" 
717                }, 
718                "spWebBEAddressPoolID":{ 
719                   "value":"[variables('derivedIds').spWebBEAddressPoolID]" 
720                }, 
721                "spWebProbeID":{ 
722                   "value":"[variables('derivedIds').spWebProbeID]" 
723                }, 
724                "spWebProbe":{ 
725                   "value":"[variables('spWebProbe')]" 
726                }, 
727                "sqlLBName":{ 
728                   "value":"[variables('lbSettings').sqlLBName]" 
729                }, 
730                "sqlLBFE":{ 
731                   "value":"[variables('lbSettings').sqlLBFE]" 
732                }, 
733                "sqlLBIPAddress":{ 
734                   "value":"[parameters('sqlLBIPAddress')]" 
735                }, 
736                "staticSubnetRef":{ 
737                   "value":"[variables('staticSubnetRef')]" 
738                }, 
739                "sqlLBBE":{ 
740                   "value":"[variables('lbSettings').sqlLBBE]" 
741                }, 
742                "sqllbFEConfigID":{ 
743                   "value":"[variables('derivedIds').sqllbFEConfigID]" 
744                }, 
745                "sqllbProbeID":{ 
746                   "value":"[variables('derivedIds').sqllbProbeID]" 
747                }, 
748                "SQLAOProbe":{ 
749                   "value":"[variables('SQLAOProbe')]" 
750                } 
751             } 
752          } 
753       }, 
754       { 
755          "name":"CreatingNetworkInterfaces", 
756          "type":"Microsoft.Resources/deployments", 
757          "apiVersion":"2015-01-01", 
758          "dependsOn":[ 
759             "Microsoft.Resources/deployments/CreatingVirtualNetwork", 
760             "Microsoft.Resources/deployments/SettingUpRdp", 
761             "Microsoft.Resources/deployments/SettingUpLoadBalancers" 
762          ], 
763          "properties":{ 
764             "mode":"Incremental", 
765             "templateLink":{ 
766                "uri":"[variables('configuration').creatingNicsUrl]", 
767                "contentVersion":"1.0.0.0" 
768             }, 
769             "parameters":{ 
770                "location":{ 
771                   "value":"[parameters('location')]" 
772                }, 
773                "adPDCNicName":{ 
774                   "value":"[variables('adPDCNicName')]" 
775                }, 
776                "adPDCNICIPAddress":{ 
777                   "value":"[parameters('adPDCNICIPAddress')]" 
778                }, 
779                "staticSubnetRef":{ 
780                   "value":"[variables('staticSubnetRef')]" 
781                }, 
782                "adBEAddressPoolID":{ 
783                   "value":"[variables('derivedIds').adBEAddressPoolID]" 
784                }, 
785                "adRDPNATRuleID":{ 
786                   "value":"[variables('derivedIds').adRDPNATRuleID]" 
787                }, 
788                "adBDCNicName":{ 
789                   "value":"[variables('adBDCNicName')]" 
790                }, 
791                "adBDCNICIPAddress":{ 
792                   "value":"[parameters('adBDCNICIPAddress')]" 
793                }, 
794                "sqlVMName":{ 
795                   "value":"[variables('vmSettings').sqlVMName]" 
796                }, 
797                "sqlSubnetRef":{ 
798                   "value":"[variables('sqlSubnetRef')]" 
799                }, 
800                "sqlBEAddressPoolID":{ 
801                   "value":"[variables('derivedIds').sqlBEAddressPoolID]" 
802                }, 
803                "spwebVMName":{ 
804                   "value":"[variables('vmSettings').spwebVMName]" 
805                }, 
806                "spWebSubnetRef":{ 
807                   "value":"[variables('spWebSubnetRef')]" 
808                }, 
809                "spWebBEAddressPoolID":{ 
810                   "value":"[variables('derivedIds').spWebBEAddressPoolID]" 
811                }, 
812                "spappVMName":{ 
813                   "value":"[variables('vmSettings').spappVMName]" 
814                }, 
815                "spAppSubnetRef":{ 
816                   "value":"[variables('spAppSubnetRef')]" 
817                }, 
818                "spCABEAddressPoolID":{ 
819                   "value":"[variables('derivedIds').spCABEAddressPoolID]" 
820                }, 
821                "spCANATRuleID":{ 
822                   "value":"[variables('derivedIds').spCANATRuleID]" 
823                }, 
824                "sqlwNicName":{ 
825                   "value":"[variables('sqlwNicName')]" 
826                } 
827             } 
828          } 
829       }, 
830       { 
831          "name":"ProvisioningPrimaryADDomainController", 
832          "type":"Microsoft.Resources/deployments", 
833          "apiVersion":"2015-01-01", 
834          "dependsOn":[ 
835             "Microsoft.Resources/deployments/CreatingStorageAccounts", 
836             "Microsoft.Resources/deployments/CreatingNetworkInterfaces", 
837             "Microsoft.Resources/deployments/CreatingAvailabilitySets", 
838             "Microsoft.Resources/deployments/SettingUpRdp" 
839          ], 
840          "properties":{ 
841             "mode":"Incremental", 
842             "templateLink":{ 
843                "uri":"[variables('configuration').provisioningPrimaryDCURL]", 
844                "contentVersion":"1.0.0.0" 
845             }, 
846             "parameters":{ 
847                "adPDCVMName":{ 
848                   "value":"[variables('vmSettings').adPDCVMName]" 
849                }, 
850                "location":{ 
851                   "value":"[parameters('location')]" 
852                }, 
853                "storageAccountNamePrefix":{ 
854                   "value":"[parameters('storageAccountNamePrefix')]" 
855                }, 
856                "availabilitySet":{ 
857                   "value":"[reference('CreatingAvailabilitySets').outputs.adAvailabilitySetName.value]" 
858                }, 
859                "adVMSize":{ 
860                   "value":"[parameters('adVMSize')]" 
861                }, 
862                "adminUsername":{ 
863                   "value":"[parameters('adminUsername')]" 
864                }, 
865                "adminPassword":{ 
866                   "value":"[parameters('adminPassword')]" 
867                }, 
868                "windowsImagePublisher":{ 
869                   "value":"[variables('vmSettings').windowsImagePublisher]" 
870                }, 
871                "windowsImageOffer":{ 
872                   "value":"[variables('vmSettings').windowsImageOffer]" 
873                }, 
874                "windowsImageSKU":{ 
875                   "value":"[variables('vmSettings').windowsImageSKU]" 
876                }, 
877                "vmContainerName":{ 
878                   "value":"[variables('vmSettings').vmContainerName]" 
879                }, 
880                "adPDCNicName":{ 
881                   "value":"[variables('adPDCNicName')]" 
882                }, 
883                "domainName":{ 
884                   "value":"[parameters('domainName')]" 
885                }, 
886                "adPDCConfigurationFunction":{ 
887                   "value":"[variables('configuration').adPDCConfigurationFunction]" 
888                }, 
889                "adPDCModulesURL":{ 
890                   "value":"[variables('configuration').adPDCModulesURL]" 
891                } 
892             } 
893          } 
894       }, 
895       { 
896          "name":"UpdatingDNStoPrimaryADVM", 
897          "type":"Microsoft.Resources/deployments", 
898          "apiVersion":"2015-01-01", 
899          "dependsOn":[ 
900             "ProvisioningPrimaryADDomainController" 
901          ], 
902          "properties":{ 
903             "mode":"Incremental", 
904             "templateLink":{ 
905                "uri":"[variables('configuration').vnetwithDNSTemplateURL]", 
906                "contentVersion":"1.0.0.0" 
907             }, 
908             "parameters":{ 
909                "location":{ 
910                   "value":"[parameters('location')]" 
911                }, 
912                "virtualNetworkName":{ 
913                   "value":"[parameters('virtualNetworkName')]" 
914                }, 
915                "virtualNetworkAddressRange":{ 
916                   "value":"[parameters('virtualNetworkAddressRange')]" 
917                }, 
918                "subnets":{ 
919                   "value":"[variables('subnets')]" 
920                }, 
921                "DNSServerAddress":{ 
922                   "value":[ 
923                      "[parameters('adPDCNICIPAddress')]" 
924                   ] 
925                } 
926             } 
927          } 
928       }, 
929       { 
930          "name":"ProvisioningBackupADDomainController", 
931          "type":"Microsoft.Resources/deployments", 
932          "apiVersion":"2015-01-01", 
933          "dependsOn":[ 
934             "Microsoft.Resources/deployments/CreatingStorageAccounts", 
935             "Microsoft.Resources/deployments/CreatingNetworkInterfaces", 
936             "Microsoft.Resources/deployments/CreatingAvailabilitySets", 
937             "Microsoft.Resources/deployments/UpdatingDNStoPrimaryADVM" 
938          ], 
939          "properties":{ 
940             "mode":"Incremental", 
941             "templateLink":{ 
942                "uri":"[variables('configuration').provisioningBackupDCURL]", 
943                "contentVersion":"1.0.0.0" 
944             }, 
945             "parameters":{ 
946                "adBDCVMName":{ 
947                   "value":"[variables('vmSettings').adBDCVMName]" 
948                }, 
949                "location":{ 
950                   "value":"[parameters('location')]" 
951                }, 
952                "storageAccountNamePrefix":{ 
953                   "value":"[parameters('storageAccountNamePrefix')]" 
954                }, 
955                "availabilitySet":{ 
956                   "value":"[reference('CreatingAvailabilitySets').outputs.adAvailabilitySetName.value]" 
957                }, 
958                "adVMSize":{ 
959                   "value":"[parameters('adVMSize')]" 
960                }, 
961                "adminUsername":{ 
962                   "value":"[parameters('adminUsername')]" 
963                }, 
964                "adminPassword":{ 
965                   "value":"[parameters('adminPassword')]" 
966                }, 
967                "windowsImagePublisher":{ 
968                   "value":"[variables('vmSettings').windowsImagePublisher]" 
969                }, 
970                "windowsImageOffer":{ 
971                   "value":"[variables('vmSettings').windowsImageOffer]" 
972                }, 
973                "windowsImageSKU":{ 
974                   "value":"[variables('vmSettings').windowsImageSKU]" 
975                }, 
976                "vmContainerName":{ 
977                   "value":"[variables('vmSettings').vmContainerName]" 
978                }, 
979                "adBDCNicName":{ 
980                   "value":"[variables('adBDCNicName')]" 
981                }, 
982                "domainName":{ 
983                   "value":"[parameters('domainName')]" 
984                }, 
985                "adBDCConfigurationFunction":{ 
986                   "value":"[variables('configuration').adBDCConfigurationFunction]" 
987                }, 
988                "adBDCModulesURL":{ 
989                   "value":"[variables('configuration').adBDCModulesURL]" 
990                } 
991             } 
992          } 
993       }, 
994       { 
995          "name":"UpdatingDNSwithBackupADVM", 
996          "type":"Microsoft.Resources/deployments", 
997          "apiVersion":"2015-01-01", 
998          "dependsOn":[ 
999             "Microsoft.Resources/deployments/ProvisioningBackupADDomainController" 
1000          ], 
1001          "properties":{ 
1002             "mode":"Incremental", 
1003             "templateLink":{ 
1004                "uri":"[variables('configuration').vnetwithDNSTemplateURL]", 
1005                "contentVersion":"1.0.0.0" 
1006             }, 
1007             "parameters":{ 
1008                "location":{ 
1009                   "value":"[parameters('location')]" 
1010                }, 
1011                "virtualNetworkName":{ 
1012                   "value":"[parameters('virtualNetworkName')]" 
1013                }, 
1014                "virtualNetworkAddressRange":{ 
1015                   "value":"[parameters('virtualNetworkAddressRange')]" 
1016                }, 
1017                "subnets":{ 
1018                   "value":"[variables('subnets')]" 
1019                }, 
1020                "DNSServerAddress":{ 
1021                   "value":[ 
1022                      "[parameters('adPDCNICIPAddress')]", 
1023                      "[parameters('adBDCNICIPAddress')]" 
1024                   ] 
1025                } 
1026             } 
1027          } 
1028       }, 
1029       { 
1030          "name":"CreatingSQLVirtualMachines", 
1031          "type":"Microsoft.Resources/deployments", 
1032          "apiVersion":"2015-01-01", 
1033          "dependsOn":[ 
1034             "Microsoft.Resources/deployments/CreatingStorageAccounts", 
1035             "Microsoft.Resources/deployments/CreatingNetworkInterfaces", 
1036             "Microsoft.Resources/deployments/CreatingAvailabilitySets", 
1037             "Microsoft.Resources/deployments/UpdatingDNStoPrimaryADVM" 
1038          ], 
1039          "properties":{ 
1040             "mode":"Incremental", 
1041             "templateLink":{ 
1042                "uri":"[variables('configuration').creatingSQLVMsURL]", 
1043                "contentVersion":"1.0.0.0" 
1044             }, 
1045             "parameters":{ 
1046                "sqlVMName":{ 
1047                   "value":"[variables('vmSettings').sqlVMName]" 
1048                }, 
1049                "location":{ 
1050                   "value":"[parameters('location')]" 
1051                }, 
1052                "storageAccountNamePrefix":{ 
1053                   "value":"[parameters('storageAccountNamePrefix')]" 
1054                }, 
1055                "availabilitySet":{ 
1056                   "value":"[reference('CreatingAvailabilitySets').outputs.sqlAvailabilitySetName.value]" 
1057                }, 
1058                "sqlVMSize":{ 
1059                   "value":"[parameters('sqlVMSize')]" 
1060                }, 
1061                "adminUsername":{ 
1062                   "value":"[parameters('adminUsername')]" 
1063                }, 
1064                "adminPassword":{ 
1065                   "value":"[parameters('adminPassword')]" 
1066                }, 
1067                "windowsImagePublisher":{ 
1068                   "value":"[variables('vmSettings').windowsImagePublisher]" 
1069                }, 
1070                "windowsImageOffer":{ 
1071                   "value":"[variables('vmSettings').windowsImageOffer]" 
1072                }, 
1073                "windowsImageSKU":{ 
1074                   "value":"[variables('vmSettings').windowsImageSKU]" 
1075                }, 
1076                "vmContainerName":{ 
1077                   "value":"[variables('vmSettings').vmContainerName]" 
1078                }, 
1079                "sqlImagePublisher":{ 
1080                   "value":"[variables('vmSettings').sqlImagePublisher]" 
1081                }, 
1082                "sqlImageOffer":{ 
1083                   "value":"[variables('vmSettings').sqlImageOffer]" 
1084                }, 
1085                "sqlImageSKU":{ 
1086                   "value":"[variables('vmSettings').sqlImageSKU]" 
1087                }, 
1088                "domainName":{ 
1089                   "value":"[parameters('domainName')]" 
1090                }, 
1091                "sqlAOPrepareModulesURL":{ 
1092                   "value":"[variables('configuration').sqlAOPrepareModulesURL]" 
1093                }, 
1094                "sqlAOPrepareConfigurationFunction":{ 
1095                   "value":"[variables('configuration').sqlAOPrepareConfigurationFunction]" 
1096                }, 
1097                "sqlAOEPName":{ 
1098                   "value":"[variables('sqlAOEPName')]" 
1099                }, 
1100                "sqlServerServiceAccountUserName":{ 
1101                   "value":"[parameters('sqlServerServiceAccountUserName')]" 
1102                }, 
1103                "sharePointSetupUserAccountUserName":{ 
1104                   "value":"[parameters('sharePointSetupUserAccountUserName')]" 
1105                }, 
1106                "sqlServerServiceAccountPassword":{ 
1107                   "value":"[parameters('sqlServerServiceAccountPassword')]" 
1108                }, 
1109                "sharePointSetupUserAccountPassword":{ 
1110                   "value":"[parameters('sharePointSetupUserAccountPassword')]" 
1111                }, 
1112                "createClusterModulesURL":{ 
1113                   "value":"[variables('configuration').createClusterModulesURL]" 
1114                }, 
1115                "createClusterConfigurationFunction":{ 
1116                   "value":"[variables('configuration').createClusterConfigurationFunction]" 
1117                }, 
1118                "clusterName":{ 
1119                   "value":"[variables('clusterName')]" 
1120                }, 
1121                "sharePath":{ 
1122                   "value":"[variables('sharePath')]" 
1123                }, 
1124                "sqlAOAGName":{ 
1125                   "value":"[variables('sqlAOAGName')]" 
1126                }, 
1127                "sqlAOListenerName":{ 
1128                   "value":"[variables('sqlAOListenerName')]" 
1129                }, 
1130                "sqlLBName":{ 
1131                   "value":"[variables('lbSettings').sqlLBName]" 
1132                }, 
1133                "sqlLBIPAddress":{ 
1134                   "value":"[parameters('sqlLBIPAddress')]" 
1135                }, 
1136                "adPDCVMName":{ 
1137                   "value":"[variables('vmSettings').adPDCVMName]" 
1138                }, 
1139                "witnessVMSize":{ 
1140                   "value":"[parameters('witnessVMSize')]" 
1141                }, 
1142                "sqlwVMName":{ 
1143                   "value":"[variables('vmSettings').sqlwVMName]" 
1144                }, 
1145                "sqlwNicName":{ 
1146                   "value":"[variables('sqlwNicName')]" 
1147                }, 
1148                "fswModulesURL":{ 
1149                   "value":"[variables('configuration').fswModulesURL]" 
1150                }, 
1151                "fswConfigurationFunction":{ 
1152                   "value":"[variables('configuration').fswConfigurationFunction]" 
1153                } 
1154             } 
1155          } 
1156       }, 
1157       { 
1158          "name":"ProvisioningSQLAlwaysOnCluster", 
1159          "type":"Microsoft.Resources/deployments", 
1160          "apiVersion":"2015-01-01", 
1161          "dependsOn":[ 
1162             "Microsoft.Resources/deployments/UpdatingDNSwithBackupADVM", 
1163             "Microsoft.Resources/deployments/CreatingSQLVirtualMachines" 
1164          ], 
1165          "properties":{ 
1166             "mode":"Incremental", 
1167             "templateLink":{ 
1168                "uri":"[variables('configuration').ProvisioningSQLAlwaysOnClusterUrl]", 
1169                "contentVersion":"1.0.0.0" 
1170             }, 
1171             "parameters":{ 
1172                "sqlVMName":{ 
1173                   "value":"[variables('vmSettings').sqlVMName]" 
1174                }, 
1175                "location":{ 
1176                   "value":"[parameters('location')]" 
1177                }, 
1178                "storageAccountNamePrefix":{ 
1179                   "value":"[parameters('storageAccountNamePrefix')]" 
1180                }, 
1181                "availabilitySet":{ 
1182                   "value":"[reference('CreatingAvailabilitySets').outputs.sqlAvailabilitySetName.value]" 
1183                }, 
1184                "sqlVMSize":{ 
1185                   "value":"[parameters('sqlVMSize')]" 
1186                }, 
1187                "adminUsername":{ 
1188                   "value":"[parameters('adminUsername')]" 
1189                }, 
1190                "adminPassword":{ 
1191                   "value":"[parameters('adminPassword')]" 
1192                }, 
1193                "windowsImagePublisher":{ 
1194                   "value":"[variables('vmSettings').windowsImagePublisher]" 
1195                }, 
1196                "windowsImageOffer":{ 
1197                   "value":"[variables('vmSettings').windowsImageOffer]" 
1198                }, 
1199                "windowsImageSKU":{ 
1200                   "value":"[variables('vmSettings').windowsImageSKU]" 
1201                }, 
1202                "vmContainerName":{ 
1203                   "value":"[variables('vmSettings').vmContainerName]" 
1204                }, 
1205                "sqlImagePublisher":{ 
1206                   "value":"[variables('vmSettings').sqlImagePublisher]" 
1207                }, 
1208                "sqlImageOffer":{ 
1209                   "value":"[variables('vmSettings').sqlImageOffer]" 
1210                }, 
1211                "sqlImageSKU":{ 
1212                   "value":"[variables('vmSettings').sqlImageSKU]" 
1213                }, 
1214                "domainName":{ 
1215                   "value":"[parameters('domainName')]" 
1216                }, 
1217                "sqlAOPrepareModulesURL":{ 
1218                   "value":"[variables('configuration').sqlAOPrepareModulesURL]" 
1219                }, 
1220                "sqlAOPrepareConfigurationFunction":{ 
1221                   "value":"[variables('configuration').sqlAOPrepareConfigurationFunction]" 
1222                }, 
1223                "sqlAOEPName":{ 
1224                   "value":"[variables('sqlAOEPName')]" 
1225                }, 
1226                "sqlServerServiceAccountUserName":{ 
1227                   "value":"[parameters('sqlServerServiceAccountUserName')]" 
1228                }, 
1229                "sharePointSetupUserAccountUserName":{ 
1230                   "value":"[parameters('sharePointSetupUserAccountUserName')]" 
1231                }, 
1232                "sqlServerServiceAccountPassword":{ 
1233                   "value":"[parameters('sqlServerServiceAccountPassword')]" 
1234                }, 
1235                "sharePointSetupUserAccountPassword":{ 
1236                   "value":"[parameters('sharePointSetupUserAccountPassword')]" 
1237                }, 
1238                "createClusterModulesURL":{ 
1239                   "value":"[variables('configuration').createClusterModulesURL]" 
1240                }, 
1241                "createClusterConfigurationFunction":{ 
1242                   "value":"[variables('configuration').createClusterConfigurationFunction]" 
1243                }, 
1244                "clusterName":{ 
1245                   "value":"[variables('clusterName')]" 
1246                }, 
1247                "sharePath":{ 
1248                   "value":"[variables('sharePath')]" 
1249                }, 
1250                "sqlAOAGName":{ 
1251                   "value":"[variables('sqlAOAGName')]" 
1252                }, 
1253                "sqlAOListenerName":{ 
1254                   "value":"[variables('sqlAOListenerName')]" 
1255                }, 
1256                "sqlLBName":{ 
1257                   "value":"[variables('lbSettings').sqlLBName]" 
1258                }, 
1259                "sqlLBIPAddress":{ 
1260                   "value":"[parameters('sqlLBIPAddress')]" 
1261                }, 
1262                "adPDCVMName":{ 
1263                   "value":"[variables('vmSettings').adPDCVMName]" 
1264                }, 
1265                "witnessVMSize":{ 
1266                   "value":"[parameters('witnessVMSize')]" 
1267                }, 
1268                "sqlwVMName":{ 
1269                   "value":"[variables('vmSettings').sqlwVMName]" 
1270                }, 
1271                "sqlwNicName":{ 
1272                   "value":"[variables('sqlwNicName')]" 
1273                }, 
1274                "fswModulesURL":{ 
1275                   "value":"[variables('configuration').fswModulesURL]" 
1276                }, 
1277                "fswConfigurationFunction":{ 
1278                   "value":"[variables('configuration').fswConfigurationFunction]" 
1279                } 
1280             } 
1281          } 
1282       }, 
1283       { 
1284          "name":"UpdatingSQLWNic", 
1285          "type":"Microsoft.Resources/deployments", 
1286          "apiVersion":"2015-01-01", 
1287          "dependsOn":[ 
1288             "Microsoft.Resources/deployments/UpdatingDNSwithBackupADVM" 
1289          ], 
1290          "properties":{ 
1291             "mode":"Incremental", 
1292             "templateLink":{ 
1293                "uri":"[variables('configuration').nicTemplateURL]", 
1294                "contentVersion":"1.0.0.0" 
1295             }, 
1296             "parameters":{ 
1297                "location":{ 
1298                   "value":"[parameters('location')]" 
1299                }, 
1300                "nicName":{ 
1301                   "value":"[variables('sqlwNicName')]" 
1302                }, 
1303                "ipConfigurations":{ 
1304                   "value":[ 
1305                      { 
1306                         "name":"ipconfig1", 
1307                         "properties":{ 
1308                            "privateIPAllocationMethod":"Dynamic", 
1309                            "subnet":{ 
1310                               "id":"[variables('sqlSubnetRef')]" 
1311                            } 
1312                         } 
1313                      } 
1314                   ] 
1315                }, 
1316                "dnsServers":{ 
1317                   "value":[ 
1318                      "[parameters('adPDCNICIPAddress')]", 
1319                      "[parameters('adBDCNICIPAddress')]" 
1320                   ] 
1321                } 
1322             } 
1323          } 
1324       }, 
1325       { 
1326          "name":"UpdatingSQL0Nic", 
1327          "type":"Microsoft.Resources/deployments", 
1328          "apiVersion":"2015-01-01", 
1329          "dependsOn":[ 
1330             "Microsoft.Resources/deployments/UpdatingSQLWNic" 
1331          ], 
1332          "properties":{ 
1333             "mode":"Incremental", 
1334             "templateLink":{ 
1335                "uri":"[variables('configuration').nicTemplateURL]", 
1336                "contentVersion":"1.0.0.0" 
1337             }, 
1338             "parameters":{ 
1339                "location":{ 
1340                   "value":"[parameters('location')]" 
1341                }, 
1342                "nicName":{ 
1343                   "value":"[concat(variables('vmSettings').sqlVMName, '0-nic')]" 
1344                }, 
1345                "ipConfigurations":{ 
1346                   "value":[ 
1347                      { 
1348                         "name":"ipconfig1", 
1349                         "properties":{ 
1350                            "privateIPAllocationMethod":"Dynamic", 
1351                            "subnet":{ 
1352                               "id":"[variables('sqlSubnetRef')]" 
1353                            }, 
1354                            "loadBalancerBackendAddressPools":[ 
1355                               { 
1356                                  "id":"[variables('derivedIds').sqlBEAddressPoolID]" 
1357                               } 
1358                            ] 
1359                         } 
1360                      } 
1361                   ] 
1362                }, 
1363                "dnsServers":{ 
1364                   "value":[ 
1365                      "[parameters('adPDCNICIPAddress')]", 
1366                      "[parameters('adBDCNICIPAddress')]" 
1367                   ] 
1368                } 
1369             } 
1370          } 
1371       }, 
1372       { 
1373          "name":"UpdatingSQL1Nic", 
1374          "type":"Microsoft.Resources/deployments", 
1375          "apiVersion":"2015-01-01", 
1376          "dependsOn":[ 
1377             "Microsoft.Resources/deployments/UpdatingSQL0Nic" 
1378          ], 
1379          "properties":{ 
1380             "mode":"Incremental", 
1381             "templateLink":{ 
1382                "uri":"[variables('configuration').nicTemplateURL]", 
1383                "contentVersion":"1.0.0.0" 
1384             }, 
1385             "parameters":{ 
1386                "location":{ 
1387                   "value":"[parameters('location')]" 
1388                }, 
1389                "nicName":{ 
1390                   "value":"[concat(variables('vmSettings').sqlVMName, '1-nic')]" 
1391                }, 
1392                "ipConfigurations":{ 
1393                   "value":[ 
1394                      { 
1395                         "name":"ipconfig1", 
1396                         "properties":{ 
1397                            "privateIPAllocationMethod":"Dynamic", 
1398                            "subnet":{ 
1399                               "id":"[variables('sqlSubnetRef')]" 
1400                            }, 
1401                            "loadBalancerBackendAddressPools":[ 
1402                               { 
1403                                  "id":"[variables('derivedIds').sqlBEAddressPoolID]" 
1404                               } 
1405                            ] 
1406                         } 
1407                      } 
1408                   ] 
1409                }, 
1410                "dnsServers":{ 
1411                   "value":[ 
1412                      "[parameters('adPDCNICIPAddress')]", 
1413                      "[parameters('adBDCNICIPAddress')]" 
1414                   ] 
1415                } 
1416             } 
1417          } 
1418       }, 
1419       { 
1420          "name":"CreatingSharepointVirtualMachines", 
1421          "type":"Microsoft.Resources/deployments", 
1422          "apiVersion":"2015-01-01", 
1423          "dependsOn":[ 
1424             "Microsoft.Resources/deployments/CreatingStorageAccounts", 
1425             "Microsoft.Resources/deployments/CreatingNetworkInterfaces", 
1426             "Microsoft.Resources/deployments/CreatingAvailabilitySets", 
1427             "Microsoft.Resources/deployments/UpdatingDNSwithBackupADVM" 
1428          ], 
1429          "properties":{ 
1430             "mode":"Incremental", 
1431             "templateLink":{ 
1432                "uri":"[variables('configuration').creatingSharepointVMsURL]", 
1433                "contentVersion":"1.0.0.0" 
1434             }, 
1435             "parameters":{ 
1436                "spappVMName":{ 
1437                   "value":"[variables('vmSettings').spappVMName]" 
1438                }, 
1439                "spwebVMName":{ 
1440                   "value":"[variables('vmSettings').spwebVMName]" 
1441                }, 
1442                "location":{ 
1443                   "value":"[parameters('location')]" 
1444                }, 
1445                "spVMSize":{ 
1446                   "value":"[parameters('spVMSize')]" 
1447                }, 
1448                "spWebAvailabilitySet":{ 
1449                   "value":"[reference('CreatingAvailabilitySets').outputs.spWebAvailabilitySetName.value]" 
1450                }, 
1451                "spAppAvailabilitySet":{ 
1452                   "value":"[reference('CreatingAvailabilitySets').outputs.spAppAvailabilitySetName.value]" 
1453                }, 
1454                "adminUsername":{ 
1455                   "value":"[parameters('adminUsername')]" 
1456                }, 
1457                "adminPassword":{ 
1458                   "value":"[parameters('adminPassword')]" 
1459                }, 
1460                "spImagePublisher":{ 
1461                   "value":"[variables('vmSettings').spImagePublisher]" 
1462                }, 
1463                "spImageOffer":{ 
1464                   "value":"[variables('vmSettings').spImageOffer]" 
1465                }, 
1466                "spImageSKU":{ 
1467                   "value":"[variables('vmSettings').spImageSKU]" 
1468                }, 
1469                "vmContainerName":{ 
1470                   "value":"[variables('vmSettings').vmContainerName]" 
1471                }, 
1472                "storageAccountNamePrefix":{ 
1473                   "value":"[parameters('storageAccountNamePrefix')]" 
1474                } 
1475             } 
1476          } 
1477       }, 
1478       { 
1479          "name":"ProvisioningSharepoint", 
1480          "type":"Microsoft.Resources/deployments", 
1481          "apiVersion":"2015-01-01", 
1482          "dependsOn":[ 
1483             "Microsoft.Resources/deployments/ProvisioningSQLAlwaysOnCluster", 
1484             "Microsoft.Resources/deployments/CreatingSharepointVirtualMachines" 
1485          ], 
1486          "properties":{ 
1487             "mode":"Incremental", 
1488             "templateLink":{ 
1489                "uri":"[variables('configuration').provisioningSharepointUrl]", 
1490                "contentVersion":"1.0.0.0" 
1491             }, 
1492             "parameters":{ 
1493                "spappVMName":{ 
1494                   "value":"[variables('vmSettings').spappVMName]" 
1495                }, 
1496                "sqlVMName":{ 
1497                   "value":"[variables('vmSettings').sqlVMName]" 
1498                }, 
1499                "location":{ 
1500                   "value":"[parameters('location')]" 
1501                }, 
1502                "spModulesURL":{ 
1503                   "value":"[variables('configuration').spModulesURL]" 
1504                }, 
1505                "spConfigurationFunction":{ 
1506                   "value":"[variables('configuration').spConfigurationFunction]" 
1507                }, 
1508                "domainName":{ 
1509                   "value":"[parameters('domainName')]" 
1510                }, 
1511                "adminUserName":{ 
1512                   "value":"[parameters('adminUserName')]" 
1513                }, 
1514                "adminPassword":{ 
1515                   "value":"[parameters('adminPassword')]" 
1516                }, 
1517                "sharePointSetupUserAccountUserName":{ 
1518                   "value":"[parameters('sharePointSetupUserAccountUserName')]" 
1519                }, 
1520                "sharePointFarmAccountUserName":{ 
1521                   "value":"[parameters('sharePointFarmAccountUserName')]" 
1522                }, 
1523                "sqlServerServiceAccountUserName":{ 
1524                   "value":"[parameters('sqlServerServiceAccountUserName')]" 
1525                }, 
1526                "sqlAOAGName":{ 
1527                   "value":"[variables('sqlAOAGName')]" 
1528                }, 
1529                "administrationContentDatabaseName":{ 
1530                   "value":"[variables('administrationContentDatabaseName')]" 
1531                }, 
1532                "configDatabaseName":{ 
1533                   "value":"[variables('configDatabaseName')]" 
1534                }, 
1535                "contentDatabaseName":{ 
1536                   "value":"[variables('contentDatabaseName')]" 
1537                }, 
1538                "sharepointCAfqdn":{ 
1539                   "value":"[reference('SettingUpSharepointCentralAdminPublicIP').outputs.fqdn.value]" 
1540                }, 
1541                "sharePointSetupUserAccountPassword":{ 
1542                   "value":"[parameters('sharePointSetupUserAccountPassword')]" 
1543                }, 
1544                "sharePointFarmAccountPassword":{ 
1545                   "value":"[parameters('sharePointFarmAccountPassword')]" 
1546                }, 
1547                "sharePointFarmPassphrasePassword":{ 
1548                   "value":"[parameters('sharePointFarmPassphrasePassword')]" 
1549                }, 
1550                "sqlServerServiceAccountPassword":{ 
1551                   "value":"[parameters('sqlServerServiceAccountPassword')]" 
1552                }, 
1553                "spwebVMName":{ 
1554                   "value":"[variables('vmSettings').spwebVMName]" 
1555                }, 
1556                "sharepointFarmName":{ 
1557                   "value":"[parameters('sharepointFarmName')]" 
1558                }, 
1559                "sharepointWebfqdn":{ 
1560                   "value":"[reference('SettingUpSharepointWebPublicIP').outputs.fqdn.value]" 
1561                }, 
1562                "spSiteTemplateName":{ 
1563                   "value":"[parameters('spSiteTemplateName')]" 
1564                } 
1565             } 
1566          } 
1567       } 
1568    ], 
1569    "outputs": { 
1570      "fqdn": { 
1571        "value": "[reference('SettingUpSharepointWebPublicIP').outputs.fqdn.value]", 
1572        "type": "string" 
1573      } 
1574    } 
1575 } 
